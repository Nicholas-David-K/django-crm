{% extends 'base.html' %}

{% block content %}

<section class="text-gray-600 body-font">
    <div class="container px-5 py-24 mx-auto">
        <div class="w-full mb-6 flex justify-between items-center py-6 border-b border-gray-200">
            <div>
                <h1 class="text-4xl text-gray-800">Leads</h1>
                <a href="{% url 'category_list' %}" class="text-indigo-500">View all Lead Categories</a>
            </div>
            
            <div>
                {% if request.user.is_organizer %}
                <a href="{% url 'lead_create' %}" class="mt-3 text-gray-500 hover:text-indigo-500 inline-flex items-center">Create Lead
                    <svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="w-4 h-4 ml-2" viewBox="0 0 24 24">
                    <path d="M5 12h14M12 5l7 7-7 7"></path>
                    </svg>
                </a>
                {% endif %}
            </div>
        </div>
      <div class="w-full mx-auto overflow-auto">
        <table class="table-auto w-full text-left whitespace-no-wrap">
          <thead>
            <tr>
              <th class="px-4 py-3 title-font tracking-wider font-medium text-gray-900 text-sm bg-gray-100 rounded-tl rounded-bl">First Name</th>
              <th class="px-4 py-3 title-font tracking-wider font-medium text-gray-900 text-sm bg-gray-100">Last Name</th>
              <th class="px-4 py-3 title-font tracking-wider font-medium text-gray-900 text-sm bg-gray-100">Age</th>
              <th class="px-4 py-3 title-font tracking-wider font-medium text-gray-900 text-sm bg-gray-100">Email</th>
              <th class="px-4 py-3 title-font tracking-wider font-medium text-gray-900 text-sm bg-gray-100">Phone Number</th>
              <th class="px-4 py-3 title-font tracking-wider font-medium text-gray-900 text-sm bg-gray-100">Category</th>
              <th class="w-10 title-font tracking-wider font-medium text-gray-900 text-sm bg-gray-100 rounded-tr rounded-br"></th>
            </tr>
          </thead>
          <tbody>
            {% for lead in leads %}
            <tr>
              <td class="px-4 py-3">{{ lead.first_name }}</td>
              <td class="px-4 py-3">{{ lead.last_name }}</td>
              <td class="px-4 py-3">{{ lead.age }}</td>
              <td class="px-4 py-3">{{ lead.email }}</td>
              <td class="px-4 py-3">{{ lead.phone_number }}</td>
              <td class="px-4 py-3">
                  {% if lead.category.name == 'Contacted' %} 
                  <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-green-800">
                    {{ lead.category }}
                  </span>
                  {% endif %}
                  {% if lead.category.name == 'Unconverted' %} 
                  <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-green-800">
                    {{ lead.category }}
                  </span>
                  {% endif %}
                  {% if lead.category.name == 'Converted' %} 
                  <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                    {{ lead.category }}
                  </span>
                  {% endif %}
                  {% if lead.category.name == None %} 
                  <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-green-800">
                    No Category
                  </span>
                  {% endif %}
              </td>
              <td class="px-4 py-3 text-lg text-indigo-500">
                  <a href="{% url 'lead_detail' lead.pk %}">Edit</a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% if unassigned_leads %}
      <h2 class="text-3xl tracking-widest text-xs title-font font-medium text-gray-400 mb-1 pt-24">Unassigned Leads</h2>
      {% endif %}
      <div class="flex flex-wrap -m-4 py-20">
        {% for lead in unassigned_leads %}
        <div class="p-4 lg:w-1/3">
          <div class="h-full bg-gray-100 bg-opacity-75 px-5 pt-10 pb-10 rounded-lg overflow-hidden text-center relative">
            <h2 class="tracking-widest text-xs title-font font-medium text-gray-400 mb-1">
              <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-green-800">
                {{ lead.category }}
              </span>
            </h2>
            <h1 class="title-font sm:text-2xl text-xl font-medium text-gray-900 mb-3">{{ lead.first_name }} {{ lead.last_name }}</h1>
            <p class="leading-relaxed mb-3">{{ lead.email }}</p>
            <a href="{% url 'assign_agent' lead.pk %}" class="text-indigo-500 inline-flex items-center">Assign Agent
              <svg class="w-4 h-4 ml-2" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path d="M5 12h14"></path>
                <path d="M12 5l7 7-7 7"></path>
              </svg>
            </a>
          </div>
        </div>
        {% empty %}
        {% endfor %}
      </div>
    </div>
  </section>
{% endblock content %}